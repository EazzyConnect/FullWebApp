<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio</title>
  <link rel="icon" href="Title-Logo.png">
  <link rel="stylesheet" href="/profile.css">
  <script src="https://kit.fontawesome.com/4aac937350.js" crossorigin="anonymous"></script>
</head>

<body>

  <header>
    <a href="profile" class="myHome">My Profile</a>

    <nav>
      <a class="editP" href="profile/edit">Create and Edit Resume</a>
      <a class="usersP" href="/users">Search Users</a>
    </nav>

  </header>

  <div class="welcome">

    <h3 class="leftTime" id="time"></h3>
    <h3 class="rightTime" id="currentTime"></h3>

  </div>

  <div class="role">

    <p> Role: {{data.role}}</p>

  </div>

  <div class="container">

    <div class="intro">

      <div class="pix">

        {{!-- <form action="/users/profile/upload" method="post" enctype="multipart/form-data">

          <img src="" alt="image" id="previewImage" style="max-width: 100%; max-height: 200px">
          <input type="file" name="image" id="imageInput" accept=".jpeg, .jpg, .png" onchange="previewImage(event)">

          <button type="submit">Upload</button>

        </form> --}}

        <h5>{{data.firstName}} {{data.lastName}}</h5>

      </div>

      <p class="introAbout"> About me:
        <br>
        {{data.aboutMe}}
      </p>

    </div>

    <br><br><br>

    <div class="resumeView">

      <h2 class="fullName"> {{data.firstName}} {{data.lastName}} {{data.otherName}}</h2>

      <div class="contactInfo">

        <h5><i class="fa-solid fa-location-dot"></i> Home: {{data.address}}</h5>

        <div class="contactInfoInner1">
          <h5><i class="fa-solid fa-phone"></i> Phone: +234{{data.phoneNumber}}</h5>
          <h5><i class="fa-solid fa-envelope"></i> Email: {{data.email}}</h5>
        </div>

        <div class="contactInfoInner2">
          <h5><i class="fa-solid fa-globe"></i> Website: {{data.website}}</h5>
          <h5><i class="fa-brands fa-facebook"></i> Facebook: {{data.links.[1].title}}</h5>
        </div>

      </div>

      <div class="aboutMe">

        <h5>ABOUT ME</h5>
        <p>{{data.aboutMe}}</p>

      </div>

      <div class="experience">

        <h5>WORK EXPERIENCE</h5>
        {{#each data.workExperience as |experience index|}}
        <h6>[ {{experience.date}} ]</h6>

        <div class="experienceInner">
          <p class="position">{{experience.position}}</p>
          <p class="employer">{{experience.employer}}</p>
          <p class="location">{{experience.location}}</p>

          {{#each experience.dutiesAndAchievements as |duty|}}

          <ul>
            <li> {{duty}}
            </li>
          </ul>

          {{/each}}

          {{!-- <button class="editButton" id="editBtn" onclick="editExperience('{{../type}}', {{index}})">Edit</button>
          --}}

          <button class="deleteBtn" onclick="deleteExperience('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>

      <div class="education">

        <h5>EDUCATION AND TRAINING</h5>

        {{#each data.educationAndTraining as |education index|}}
        <h6>[ {{education.date}} ]</h6>

        <div class="educationInner">
          <p class="degree">{{education.degree}}</p>
          <p class="institution">{{education.institutionAttended}}</p>
          <p class="location">{{education.location}}</p>
          <p class="website">{{education.website}}</p>

          {{#each education.projectAndAchievement as |project|}}

          <ul>
            <li> {{project}}
            </li>
          </ul>

          {{/each}}

          <button class="deleteBtn" onclick="deleteEducation('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>

      <div class="profOrg">

        <h5>PROFESSIONAL ORGANIZATION</h5>
        {{#each data.professionalOrganization as |profOrg index|}}
        <h6>[ {{profOrg.date}} ]</h6>

        <div class="profOrgInner">
          <p class="certification">{{profOrg.certification}}</p>
          <p class="organization">{{profOrg.organization}}</p>
          <p class="location">{{profOrg.location}}</p>
          <p class="website">{{profOrg.website}}</p>

          <button class="deleteBtn" onclick="deleteProfOrg('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>

      <div class="otherExperience">

        <h5>OTHER EXPERIENCE</h5>
        {{#each data.otherExperience as |otherExperience index|}}
        <h6>[ {{otherExperience.date}} ]</h6>

        <div class="otherExperienceInner">
          <p class="position">{{otherExperience.position}}</p>
          <p class="employer">{{otherExperience.employer}}</p>
          <p class="location">{{otherExperience.location}}</p>

          {{#each otherExperience.dutiesAndAchievements as |duty|}}

          <ul>
            <li> {{duty}}
            </li>
          </ul>

          {{/each}}

          <button class="deleteBtn" onclick="deleteOtherExp('{{../type}}', {{index}})">Delete</button>


        </div>

        {{/each}}

      </div>

      <div class="skills">

        <h5>SKILLS</h5>
        {{#each data.skills as |skills index|}}

        <div class="skillsInner">
          <p>||{{skills}}||</p>

          <button class="deleteBtn" onclick="deleteSkill('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>

      <div class="project">

        <h5>PROJECTS</h5>
        {{#each data.projects as |project index|}}
        <h6>[ {{project.date}} ]</h6>

        <div class="projectInner">
          <p class="title">{{project.title}}</p>
          <p class="details">{{project.details}}</p>
          <p class="link">{{project.link}}</p>

          <button class="deleteBtn" onclick="deleteProject('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>

      <div class="referee">

        <h5>REFEREES</h5>
        {{#each data.referees as |referee index|}}

        <div class="refereeInner">
          <p class="name">{{referee.fullName}}</p>
          <p class="phone">+234{{referee.phone}}</p>
          <p class="occupation">{{referee.occupation}}</p>

          <button class="deleteBtn" onclick="deleteReferee('{{../type}}', {{index}})">Delete</button>

        </div>

        {{/each}}

      </div>
    </div>

  </div>

  <button class="logoutButton">LOG-OUT</button>


  <script>


    async function deleteExperience(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "workExperience",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.experienceContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }


    async function deleteEducation(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "educationAndTraining",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.educationContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    async function deleteProfOrg(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "professionalOrganization",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.profOrgContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    async function deleteOtherExp(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "otherExperience",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.otherExpContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    async function deleteProject(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "projects",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.projectContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    async function deleteSkill(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "skills",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.skillContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    async function deleteReferee(type, index) {
      const confirmation = confirm("Are you sure you want to delete this item?");
      try {
        if (confirmation) {
          const response = await fetch("/users/profile/delete", {
            method: 'POST',
            headers: {
              'content-Type': 'application/json'
            },
            body: JSON.stringify({
              type: "referees",
              index: index
            }),
          })
          const data = await response.json();
          if (data.success) {
            document.querySelector('.projectContainer:nth-child(${index + 1})').remove()
          } else {
            console.log("error")
          }
        }
      }
      catch (error) {
        console.log("Error caught")
      }
      location.reload()
    }



    const logoutButton = document.querySelector(".logoutButton");
    logoutButton.addEventListener("click", async () => {
      const response = await fetch("/auth/logout", {
        method: "POST"
      });
      if (response.ok) {
        window.location.href = "/home"
      }
    })


    const greetings = document.getElementById("time");
    const date = new Date()
    const hour = date.getHours()
    function getGreeting() {
      if (hour < 12) {
        return "Good Morning {{ data.firstName }},"
      } else if (hour >= 12 && hour < 18) {
        return "Good Afternoon {{ data.firstName }},"
      } else {
        return "Good Evening {{ data.firstName }},"
      }
    }
    greetings.textContent = getGreeting();


    const time = document.getElementById("currentTime");
    setInterval(() => {
      const newTime = new Date();
      time.innerHTML = newTime.toLocaleString()
    }, 1000)




    function previewImage(event) {
      const preview = document.getElementById('previewImage');
      const fileInput = document.getElementById('imageInput');

      const file = fileInput.files[0];

      if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          preview.src = e.target.result;
        };

        reader.readAsDataURL(file);
      }
    }

  </script>
</body>

</html>